<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>oracle-helpers</title><meta name="description" content="Documentation for oracle-helpers"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">oracle-helpers</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>oracle-helpers </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#oracle-helpers" id="oracle-helpers" style="color: inherit; text-decoration: none;">
  <h1>Oracle Helpers</h1>
</a>
<p>A collection of helpers for alleviating boilerplate in OracleDB projects</p>
<p><a href="#SQL-Template-Tag">SQL Template Tag</a></p>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h1>Installation</h1>
</a>
<p>Install using</p>
<pre><code><span class="hl-5">npm</span><span class="hl-1"> </span><span class="hl-5">install</span><span class="hl-1"> </span><span class="hl-5">oracle</span><span class="hl-1">-</span><span class="hl-5">helpers</span>
</code></pre>

<a href="#api-page" id="api-page" style="color: inherit; text-decoration: none;">
  <h3>API Page</h3>
</a>
<p><a href="https://abbvie-external.github.io/oracle-helpers/">https://abbvie-external.github.io/oracle-helpers/</a></p>

<a href="#options" id="options" style="color: inherit; text-decoration: none;">
  <h1>Options</h1>
</a>
<p>Configuration lets you set up certain behaviors to customize how the pools work outside of oracle</p>
<pre><code class="language-js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">configuration</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><span class="hl-8">/** Amount of time (in ms) between pings to check on connection behavior. */</span><br/><span class="hl-5">configuration</span><span class="hl-1">.</span><span class="hl-5">pingTime</span><span class="hl-1"> = </span><span class="hl-4">60000</span><span class="hl-1">; </span><span class="hl-8">// 1 minute</span><br/><span class="hl-8">/** Amount of time to wait (in ms) for getting a connection before deciding that there&#39;s a problem with the pool */</span><br/><span class="hl-5">configuration</span><span class="hl-1">.</span><span class="hl-5">connectionTimeout</span><span class="hl-1"> = </span><span class="hl-4">10000</span><span class="hl-1">; </span><span class="hl-8">// 10 seconds</span><br/><span class="hl-8">/** Amount of time to wait (in ms) for the ping to complete before deciding that there&#39;s a problem with the pool */</span><br/><span class="hl-5">configuration</span><span class="hl-1">.</span><span class="hl-5">pingTimeout</span><span class="hl-1"> = </span><span class="hl-4">3000</span><span class="hl-1">; </span><span class="hl-8">// 3 seconds</span>
</code></pre>
<p>poolOptions lets you set the behavior of the pools within oracle</p>
<pre><code class="language-js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">poolOptions</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">poolOptions</span><span class="hl-1">[</span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">] = {</span><br/><span class="hl-1">  </span><span class="hl-5">poolMin:</span><span class="hl-1"> </span><span class="hl-4">12</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">poolMax:</span><span class="hl-1"> </span><span class="hl-4">20</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">poolTimeout:</span><span class="hl-1"> </span><span class="hl-4">120</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code></pre>
<p>For improved debugging, you can set up a function to log the errors from oracle with the sql and parameters</p>
<pre><code class="language-js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">setSqlErrorLogger</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-2">NODE_ENV</span><span class="hl-1"> === </span><span class="hl-3">&#39;development&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">setSqlErrorLogger</span><span class="hl-1">((</span><span class="hl-5">error</span><span class="hl-1">, </span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">params</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-5">error</span><span class="hl-1">, </span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">params</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h1>Usage</h1>
</a>

<a href="#sql-tagged-template-vs-sql-text--params" id="sql-tagged-template-vs-sql-text--params" style="color: inherit; text-decoration: none;">
  <h2>sql tagged template vs sql text + params:</h2>
</a>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">getSql</span><span class="hl-1">, </span><span class="hl-5">getSqlPool</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-8">// sql tagged template!</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM TABLE where ID=</span><span class="hl-0">${</span><span class="hl-4">5</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-6">getSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">ID</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-5">NAME</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> }[]&gt;(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-5">rows</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">rows</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// sql text + params:</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">sqlText</span><span class="hl-1"> = </span><span class="hl-3">`SELECT * FROM TABLE where ID=:id`</span><span class="hl-1">;</span><br/><br/><span class="hl-6">getSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">ID</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-5">NAME</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> }[]&gt;(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">sqlText</span><span class="hl-1">, { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">5</span><span class="hl-1"> }).</span><span class="hl-6">then</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-5">rows</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">rows</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// sql tagged template with params (for syntax highlighting only):</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query2</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM TABLE where ID=:id`</span><span class="hl-1">;</span><br/><br/><span class="hl-6">getSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">ID</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-5">NAME</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> }[]&gt;(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query2</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">, { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">5</span><span class="hl-1"> }).</span><span class="hl-6">then</span><span class="hl-1">(</span><br/><span class="hl-1">  (</span><span class="hl-5">rows</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">rows</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code></pre>

<a href="#getters" id="getters" style="color: inherit; text-decoration: none;">
  <h2>Getters</h2>
</a>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">getSql</span><span class="hl-1">, </span><span class="hl-5">getSqlPool</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM TABLE where ID=</span><span class="hl-0">${</span><span class="hl-4">5</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-6">getSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">ID</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-5">NAME</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> }[]&gt;(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-5">rows</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">rows</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">getSqlPool</span><span class="hl-1">&lt;{ </span><span class="hl-5">ID</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">; </span><span class="hl-5">NAME</span><span class="hl-1">: </span><span class="hl-9">string</span><span class="hl-1"> }[]&gt;(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">).</span><span class="hl-6">then</span><span class="hl-1">((</span><span class="hl-5">rows</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">rows</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#mutations" id="mutations" style="color: inherit; text-decoration: none;">
  <h2>Mutations</h2>
</a>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">sql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">mutateSql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">mutateSqlPool</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">mutateManySql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">mutateManySqlPool</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-6">runSql</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-3">`INSERT INTO TABLE (ID, NAME) VALUES (:id, :name)`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateSql</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">, { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">5</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateSqlPool</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">, { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">6</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test2&#39;</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">  </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySql</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">, [</span><br/><span class="hl-1">    { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">7</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test3&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">8</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test4&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  ]);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySqlPool</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">, [</span><br/><span class="hl-1">    { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">8</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test5&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-4">9</span><span class="hl-1">, </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test6&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  ]);</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-8">// Using the full tagged template query with different values than what was started with doesn&#39;t work, so use mutateMany if you need multiple values at once:</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-6">runSql</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`INSERT INTO TABLE (ID, NAME)</span><br/><span class="hl-3">                    VALUES (</span><span class="hl-0">${</span><span class="hl-10">[</span><span class="hl-4">7</span><span class="hl-10">, </span><span class="hl-4">8</span><span class="hl-10">, </span><span class="hl-4">9</span><span class="hl-10">, </span><span class="hl-4">10</span><span class="hl-10">]</span><span class="hl-0">}</span><span class="hl-3">,</span><br/><span class="hl-3">                            </span><span class="hl-0">${</span><span class="hl-10">[</span><span class="hl-3">&#39;test&#39;</span><span class="hl-10">, </span><span class="hl-3">&#39;test2&#39;</span><span class="hl-10">, </span><span class="hl-3">&#39;test3&#39;</span><span class="hl-10">, </span><span class="hl-3">&#39;test4&#39;</span><span class="hl-10">]</span><span class="hl-0">}</span><br/><span class="hl-3">                          )`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySql</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#tobinddefs" id="tobinddefs" style="color: inherit; text-decoration: none;">
  <h2>toBindDefs</h2>
</a>
<p>You can use <code>toBindDefs</code> to automatically set up bind definitions from the values from the Sql template tag result.</p>
<p>This is especially important in <code>mutateMany</code> in which you can&#39;t include the bind definitions as part of the parameters (due to how Node Oracledb works).</p>
<p>This means that if you want to use <code>returning</code> in mutateMany, you need to set up the whole bind definitions object yourself. And that&#39;s what <code>toBindDefs</code> helps solve.</p>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> </span><span class="hl-5">OracleDB</span><span class="hl-1"> </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracledb&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">mutateManySqlPool</span><span class="hl-1">, </span><span class="hl-5">toBindDefs</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-6">runSql</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`INSERT INTO books (author, genre) values(</span><span class="hl-0">${</span><span class="hl-10">[</span><br/><span class="hl-10">    </span><span class="hl-3">&#39;bob&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">    </span><span class="hl-3">&#39;joe&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">    </span><span class="hl-3">&#39;bill&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">  ]</span><span class="hl-0">}</span><span class="hl-3">, </span><span class="hl-0">${</span><span class="hl-3">&#39;fantasy&#39;</span><span class="hl-0">}</span><span class="hl-3">) RETURNING id into :id`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-8">// Important to pull values out of query ahead of time to avoid extra calculations.</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">values</span><span class="hl-1">, </span><span class="hl-5">sql</span><span class="hl-1">: </span><span class="hl-2">sqlQuery</span><span class="hl-1"> } = </span><span class="hl-5">query</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySqlPool</span><span class="hl-1">&lt;{ </span><span class="hl-5">id</span><span class="hl-1">: [</span><span class="hl-9">number</span><span class="hl-1">] }&gt;(</span><br/><span class="hl-1">    </span><span class="hl-5">dbConfig</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">sqlQuery</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">values</span><span class="hl-1">,</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">bindDefs:</span><span class="hl-1"> </span><span class="hl-6">toBindDefs</span><span class="hl-1">(</span><span class="hl-5">values</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-5">id:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">dir:</span><span class="hl-1"> </span><span class="hl-5">OracleDB</span><span class="hl-1">.</span><span class="hl-2">BIND_OUT</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-5">OracleDB</span><span class="hl-1">.</span><span class="hl-2">NUMBER</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ids</span><span class="hl-1"> = </span><span class="hl-5">results</span><span class="hl-1">.</span><span class="hl-5">outBinds</span><span class="hl-1">.</span><span class="hl-6">map</span><span class="hl-1">(({ </span><span class="hl-5">id</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1">[</span><span class="hl-4">0</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;newIds:&#39;</span><span class="hl-1">, </span><span class="hl-5">ids</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#advanced" id="advanced" style="color: inherit; text-decoration: none;">
  <h2>Advanced</h2>
</a>
<p>Run multiple mutations with a get inbetween in a single all-or-nothing transaction including returning a value from an insert.</p>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">STRING</span><span class="hl-1">, </span><span class="hl-5">NUMBER</span><span class="hl-1">, </span><span class="hl-5">BIND_OUT</span><span class="hl-1">, </span><span class="hl-5">BIND_IN</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracledb&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">getPoolConnection</span><span class="hl-1">, </span><span class="hl-5">getSql</span><span class="hl-1">, </span><span class="hl-5">mutateSql</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">sql</span><span class="hl-1"> = </span><span class="hl-3">`INSERT INTO TABLE (ID, NAME) VALUES (ID_SEQ.NEXT_VAL, :name) returning ID into :id`</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">selectSql</span><span class="hl-1"> = </span><span class="hl-3">`SELECT * FROM TABLE where ID=:id`</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-6">runSql</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">connection</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">getPoolConnection</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">[] }&gt;(</span><br/><span class="hl-1">      </span><span class="hl-5">connection</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">sql</span><span class="hl-1">,</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">bindDefs:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">name:</span><span class="hl-1"> { </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">STRING</span><span class="hl-1">, </span><span class="hl-5">dir:</span><span class="hl-1"> </span><span class="hl-2">BIND_IN</span><span class="hl-1"> },</span><br/><span class="hl-1">          </span><span class="hl-5">id:</span><span class="hl-1"> { </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">NUMBER</span><span class="hl-1">, </span><span class="hl-5">dir:</span><span class="hl-1"> </span><span class="hl-2">BIND_OUT</span><span class="hl-1"> },</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">id</span><span class="hl-1"> = </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">outBinds</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">[</span><span class="hl-4">0</span><span class="hl-1">];</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">row</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">getSql</span><span class="hl-1">(</span><span class="hl-5">connection</span><span class="hl-1">, </span><span class="hl-5">selectSql</span><span class="hl-1">, { </span><span class="hl-5">id</span><span class="hl-1"> })[</span><span class="hl-4">0</span><span class="hl-1">];</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">insertMultipleSql</span><span class="hl-1"> = </span><span class="hl-3">`INSERT INTO TABLE_TERM (TABLE_ID, TERM_ID, TERM) VALUES (:tableId, ID_SEQ.NEXT_VAL, :term)`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">terms</span><span class="hl-1"> = [</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Yes&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;No&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Maybe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Y&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;N&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;M&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Yeah&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Nah&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Aye&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Nay&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    ];</span><br/><br/><span class="hl-1">    </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySql</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-5">connection</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">insertMultipleSql</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">terms</span><span class="hl-1">.</span><span class="hl-6">map</span><span class="hl-1">((</span><span class="hl-5">term</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({ </span><span class="hl-5">tableId:</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1">, </span><span class="hl-5">term</span><span class="hl-1"> })),</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">autoCommit:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-8">// Make it commit upon success.</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  } </span><span class="hl-7">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">// Close the connection. This should only be necessary on success, as if there&#39;s an error it&#39;ll automatically rollback/close the connection before propagating the error</span><br/><span class="hl-1">    </span><span class="hl-5">connection</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#advanced-with-the-tagged-template" id="advanced-with-the-tagged-template" style="color: inherit; text-decoration: none;">
  <h3>Advanced with the tagged template:</h3>
</a>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">STRING</span><span class="hl-1">, </span><span class="hl-5">NUMBER</span><span class="hl-1">, </span><span class="hl-5">BIND_IN</span><span class="hl-1">, </span><span class="hl-5">BIND_OUT</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracledb&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">sql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">getPoolConnection</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">getSql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">mutateSql</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">toBindDefs</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle-helpers&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dbConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">user:</span><span class="hl-1"> </span><span class="hl-3">&#39;username&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">password:</span><span class="hl-1"> </span><span class="hl-3">&#39;password&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">connectString:</span><span class="hl-1"> </span><span class="hl-3">&#39;oracle db connection string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-6">runSql</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">connection</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">getPoolConnection</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> = </span><span class="hl-3">&#39;test&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateSql</span><span class="hl-1">&lt;{ </span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">[] }&gt;(</span><br/><span class="hl-1">      </span><span class="hl-5">connection</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">sql</span><span class="hl-3">`INSERT INTO TABLE (ID, NAME)</span><br/><span class="hl-3">        VALUES (ID_SEQ.NEXT_VAL,</span><span class="hl-0">${</span><span class="hl-5">value</span><span class="hl-0">}</span><span class="hl-3">)</span><br/><span class="hl-3">        returning ID into </span><span class="hl-0">${</span><span class="hl-10">{</span><br/><span class="hl-10">          </span><span class="hl-5">dir:</span><span class="hl-10"> </span><span class="hl-2">BIND_OUT</span><span class="hl-10">,</span><br/><span class="hl-10">          </span><span class="hl-5">type:</span><span class="hl-10"> </span><span class="hl-2">NUMBER</span><span class="hl-10">,</span><br/><span class="hl-10">          </span><span class="hl-5">name:</span><span class="hl-10"> </span><span class="hl-3">&#39;id&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">        }</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">,</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">id</span><span class="hl-1"> = </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">outBinds</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">[</span><span class="hl-4">0</span><span class="hl-1">];</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">selectSql</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM TABLE where ID=</span><span class="hl-0">${</span><span class="hl-5">id</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">row</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">getSql</span><span class="hl-1">(</span><span class="hl-5">connection</span><span class="hl-1">, </span><span class="hl-5">selectSql</span><span class="hl-1">)[</span><span class="hl-4">0</span><span class="hl-1">];</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">terms</span><span class="hl-1"> = [</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Yes&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;No&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Maybe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Y&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;N&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;M&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Yeah&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Nah&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Aye&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;Nay&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    ];</span><br/><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">insertMultipleSql</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`INSERT INTO TABLE_TERM</span><br/><span class="hl-3">           (TABLE_ID, TERM_ID, TERM)</span><br/><span class="hl-3">    VALUES (</span><span class="hl-0">${</span><span class="hl-5">id</span><span class="hl-0">}</span><span class="hl-3">, ID_SEQ.NEXT_VAL, </span><span class="hl-0">${</span><span class="hl-5">terms</span><span class="hl-0">}</span><span class="hl-3">) returning TERM_ID into :termId`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">results</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-6">mutateManySql</span><span class="hl-1">&lt;{ </span><span class="hl-5">termId</span><span class="hl-1">: [</span><span class="hl-9">number</span><span class="hl-1">] }&gt;(</span><br/><span class="hl-1">      </span><span class="hl-5">connection</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">insertMultipleSql</span><span class="hl-1">,</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">autoCommit:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-8">// Make it commit upon success.</span><br/><span class="hl-1">        </span><span class="hl-5">bindDefs:</span><span class="hl-1"> </span><span class="hl-6">toBindDefs</span><span class="hl-1">(</span><span class="hl-5">values</span><span class="hl-1">, {</span><br/><span class="hl-1">          </span><span class="hl-5">termId:</span><span class="hl-1"> { </span><span class="hl-5">dir:</span><span class="hl-1"> </span><span class="hl-2">BIND_OUT</span><span class="hl-1">, </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">NUMBER</span><span class="hl-1"> },</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">termIds</span><span class="hl-1"> = </span><span class="hl-5">results</span><span class="hl-1">.</span><span class="hl-5">outBinds</span><span class="hl-1">.</span><span class="hl-6">map</span><span class="hl-1">(({ </span><span class="hl-5">termId</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">termId</span><span class="hl-1">[</span><span class="hl-4">0</span><span class="hl-1">]);</span><br/><span class="hl-1">    </span><span class="hl-7">return</span><span class="hl-1"> </span><span class="hl-5">termIds</span><span class="hl-1">;</span><br/><span class="hl-1">  } </span><span class="hl-7">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">// Close the connection - Very important!</span><br/><span class="hl-1">    </span><span class="hl-5">connection</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#sql-template-tag" id="sql-template-tag" style="color: inherit; text-decoration: none;">
  <h1>SQL Template Tag</h1>
</a>
<blockquote>
<p>ES2015 tagged template string for preparing SQL statements, works for this oracle helpers library.</p>
</blockquote>

<a href="#modified-from" id="modified-from" style="color: inherit; text-decoration: none;">
  <h3>Modified from:</h3>
</a>
<p><a href="https://github.com/blakeembrey/sql-template-tag">https://github.com/blakeembrey/sql-template-tag</a></p>

<a href="#installation-1" id="installation-1" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<pre><code><span class="hl-5">npm</span><span class="hl-1"> </span><span class="hl-5">install</span><span class="hl-1"> </span><span class="hl-5">sql</span><span class="hl-1">-</span><span class="hl-5">template</span><span class="hl-1">-</span><span class="hl-5">tag</span><span class="hl-1"> --</span><span class="hl-5">save</span>
</code></pre>

<a href="#extension-for-syntax-highlighting-basic" id="extension-for-syntax-highlighting-basic" style="color: inherit; text-decoration: none;">
  <h2>Extension for syntax highlighting (basic):</h2>
</a>
<p><a href="https://marketplace.visualstudio.com/items?itemName=frigus02.vscode-sql-tagged-template-literals-syntax-only">https://marketplace.visualstudio.com/items?itemName=frigus02.vscode-sql-tagged-template-literals-syntax-only</a></p>

<a href="#usage-1" id="usage-1" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<pre><code class="language-ts"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">empty</span><span class="hl-1">, </span><span class="hl-5">join</span><span class="hl-1">, </span><span class="hl-5">raw</span><span class="hl-1">, </span><span class="hl-5">getSql</span><span class="hl-1">, </span><span class="hl-5">mutateManySql</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-3">&#39;sql-template-tag&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM books WHERE id = </span><span class="hl-0">${</span><span class="hl-5">id</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">; </span><span class="hl-8">//=&gt; &quot;SELECT * FROM books WHERE id = $1&quot;</span><br/><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">values</span><span class="hl-1">; </span><span class="hl-8">//=&gt; {1: id}</span><br/><br/><span class="hl-6">getSql</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">values</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Embed SQL instances inside SQL instances.</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">nested</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT id FROM authors WHERE name = </span><span class="hl-0">${</span><span class="hl-3">&#39;Blake&#39;</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM books WHERE author_id IN (</span><span class="hl-0">${</span><span class="hl-5">nested</span><span class="hl-0">}</span><span class="hl-3">)`</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Join and &quot;empty&quot; helpers (useful for nested queries).</span><br/><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM books </span><span class="hl-0">${</span><span class="hl-5">hasIds</span><span class="hl-10"> </span><span class="hl-1">?</span><span class="hl-10"> </span><span class="hl-6">sql</span><span class="hl-3">`WHERE ids IN (</span><span class="hl-0">${</span><span class="hl-6">join</span><span class="hl-10">(</span><span class="hl-5">ids</span><span class="hl-10">)</span><span class="hl-0">}</span><span class="hl-3">)`</span><span class="hl-10"> </span><span class="hl-1">:</span><span class="hl-10"> </span><span class="hl-5">empty</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Mutate Many</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">mutation</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`INSERT INTO books (author, genre) values(</span><span class="hl-0">${</span><span class="hl-10">[</span><br/><span class="hl-10">  </span><span class="hl-3">&#39;bob&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">  </span><span class="hl-3">&#39;joe&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">  </span><span class="hl-3">&#39;bill&#39;</span><span class="hl-10">,</span><br/><span class="hl-10">]</span><span class="hl-0">}</span><span class="hl-3">, </span><span class="hl-0">${</span><span class="hl-10">[</span><span class="hl-3">&#39;fantasy&#39;</span><span class="hl-10">, </span><span class="hl-3">&#39;historical&#39;</span><span class="hl-10">, </span><span class="hl-3">&#39;romance&#39;</span><span class="hl-10">]</span><span class="hl-0">}</span><span class="hl-3">)`</span><span class="hl-1">;</span><br/><span class="hl-6">mutateManySql</span><span class="hl-1">(</span><span class="hl-5">dbConfig</span><span class="hl-1">, </span><span class="hl-5">mutation</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">, </span><span class="hl-5">mutation</span><span class="hl-1">.</span><span class="hl-5">values</span><span class="hl-1">);</span>
</code></pre>

<a href="#join" id="join" style="color: inherit; text-decoration: none;">
  <h3>Join</h3>
</a>
<p>Accepts an array of values and returns a SQL instance with the values joined by the separator. E.g.</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">query</span><span class="hl-1"> = </span><span class="hl-6">join</span><span class="hl-1">([</span><span class="hl-4">1</span><span class="hl-1">, </span><span class="hl-4">2</span><span class="hl-1">, </span><span class="hl-4">3</span><span class="hl-1">]);</span><br/><br/><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">; </span><span class="hl-8">//=&gt; &quot;:1, :2, :3&quot;</span><br/><span class="hl-5">query</span><span class="hl-1">.</span><span class="hl-5">values</span><span class="hl-1">; </span><span class="hl-8">//=&gt; {1: 1, 2: 2, 3: 3}</span>
</code></pre>
<p>It can also be used to create dynamic SQL by joining multiple values together.</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">queries</span><span class="hl-1"> = [</span><span class="hl-6">sql</span><span class="hl-3">`one = </span><span class="hl-0">${</span><span class="hl-4">1</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-6">sql</span><span class="hl-3">`two = </span><span class="hl-0">${</span><span class="hl-4">2</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-6">sql</span><span class="hl-3">`three = </span><span class="hl-0">${</span><span class="hl-4">3</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">];</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">filters</span><span class="hl-1"> = </span><span class="hl-6">join</span><span class="hl-1">(</span><span class="hl-5">queries</span><span class="hl-1">, </span><span class="hl-3">&#39; AND &#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`select * from table </span><span class="hl-0">${</span><br/><span class="hl-10">  </span><span class="hl-5">filters</span><span class="hl-10"> </span><span class="hl-1">===</span><span class="hl-10"> </span><span class="hl-5">empty</span><span class="hl-10"> </span><span class="hl-1">?</span><span class="hl-10"> </span><span class="hl-5">empty</span><span class="hl-10"> </span><span class="hl-1">:</span><span class="hl-10"> </span><span class="hl-6">sql</span><span class="hl-3">`WHERE </span><span class="hl-0">${</span><span class="hl-5">filters</span><span class="hl-0">}</span><span class="hl-3">`</span><br/><span class="hl-0">}</span><span class="hl-3"> ORDER BY two`</span><span class="hl-1">;</span><br/><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">sql</span><span class="hl-1">; </span><span class="hl-8">//=&gt; &quot;select * from table WHERE one = :1 AND two = :2 AND three = :3 ORDER BY two&quot;</span><br/><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">values</span><span class="hl-1">; </span><span class="hl-8">//=&gt; {1: 1, 2: 2, 3: 3}</span>
</code></pre>
<p>By making a quick helper, you can simplify this use case:</p>
<pre><code class="language-js"><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-6">joinWhere</span><span class="hl-1">(</span><span class="hl-5">filters</span><span class="hl-1">, </span><span class="hl-5">useAndAfter</span><span class="hl-1"> = </span><span class="hl-0">false</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">useAndAfter</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">filters</span><span class="hl-1"> = </span><span class="hl-5">filters</span><span class="hl-1">.</span><span class="hl-6">concat</span><span class="hl-1">(</span><span class="hl-5">empty</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-5">filters</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">return</span><span class="hl-1"> </span><span class="hl-3">`WHERE </span><span class="hl-0">${</span><span class="hl-6">join</span><span class="hl-10">(</span><span class="hl-5">filters</span><span class="hl-10">.</span><span class="hl-6">concat</span><span class="hl-10">(</span><span class="hl-5">empty</span><span class="hl-10">), </span><span class="hl-3">&#39; AND &#39;</span><span class="hl-10">)</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">queries</span><span class="hl-1"> = [</span><span class="hl-6">sql</span><span class="hl-3">`one = </span><span class="hl-0">${</span><span class="hl-4">1</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-6">sql</span><span class="hl-3">`two = </span><span class="hl-0">${</span><span class="hl-4">2</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-6">sql</span><span class="hl-3">`three = </span><span class="hl-0">${</span><span class="hl-4">3</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">];</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-6">sql</span><span class="hl-3">`select * from table </span><span class="hl-0">${</span><span class="hl-6">joinWhere</span><span class="hl-10">(</span><span class="hl-5">queries</span><span class="hl-10">)</span><span class="hl-0">}</span><span class="hl-3"> ORDER BY two`</span><span class="hl-1">;</span>
</code></pre>

<a href="#raw" id="raw" style="color: inherit; text-decoration: none;">
  <h3>Raw</h3>
</a>
<p>Accepts a string and returns a SQL instance, useful if you want some part of the SQL to be dynamic.</p>
<pre><code class="language-js"><span class="hl-6">raw</span><span class="hl-1">(</span><span class="hl-3">&#39;SELECT&#39;</span><span class="hl-1">); </span><span class="hl-8">// == sql`SELECT`</span>
</code></pre>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">input</span><span class="hl-1"> = </span><span class="hl-3">&#39;devUsers&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">TABLES</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-9">Map</span><span class="hl-1">([</span><br/><span class="hl-1">  [</span><span class="hl-3">&#39;users&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;ENV.USERS&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  [</span><span class="hl-3">&#39;devUsers&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;DEV_ENV.USERS&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">]);</span><br/><span class="hl-6">sql</span><span class="hl-3">`SELECT * FROM </span><span class="hl-0">${</span><span class="hl-6">raw</span><span class="hl-10">(</span><span class="hl-2">TABLES</span><span class="hl-10">.</span><span class="hl-6">get</span><span class="hl-10">(</span><span class="hl-5">input</span><span class="hl-10">))</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">; </span><span class="hl-8">// == sql`SELECT * FROM DEV_ENV.USERS`</span>
</code></pre>
<p><strong>Do not</strong> accept raw user input to <code>raw</code>, this will create a SQL injection vulnerability.</p>

<a href="#empty" id="empty" style="color: inherit; text-decoration: none;">
  <h3>Empty</h3>
</a>
<p>Simple placeholder value for an empty SQL string. Equivalent to <code>raw(&quot;&quot;)</code>.</p>
<p>You can use this to great effect when creating dynamic SQL.</p>
<pre><code class="language-ts"><span class="hl-8">/**</span><br/><span class="hl-8"> * if the value passed in is a boolean, treat it as empty</span><br/><span class="hl-8"> *</span><br/><span class="hl-8"> * great for ensuring short-circuiting behavior while still being more readable than nested ternaries directly</span><br/><span class="hl-8"> */</span><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-6">sqlBool</span><span class="hl-1">(</span><span class="hl-5">sql</span><span class="hl-1">: </span><span class="hl-9">boolean</span><span class="hl-1"> | </span><span class="hl-9">RawValue</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">return</span><span class="hl-1"> </span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-5">sql</span><span class="hl-1"> === </span><span class="hl-3">&#39;boolean&#39;</span><span class="hl-1"> ? </span><span class="hl-5">empty</span><span class="hl-1"> : </span><span class="hl-5">sql</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">isUpdate</span><span class="hl-1"> = </span><span class="hl-0">false</span><span class="hl-1">;</span><br/><span class="hl-6">sql</span><span class="hl-3">`</span><span class="hl-0">${</span><span class="hl-6">sqlBool</span><span class="hl-10">(</span><span class="hl-5">isUpdate</span><span class="hl-10"> </span><span class="hl-1">&amp;&amp;</span><span class="hl-10"> </span><span class="hl-6">sql</span><span class="hl-3">`UPDATE Test WHERE ...`</span><span class="hl-10">)</span><span class="hl-0">}</span><span class="hl-3">`</span><span class="hl-1">;</span>
</code></pre>

<a href="#related" id="related" style="color: inherit; text-decoration: none;">
  <h2>Related</h2>
</a>
<p>Some other modules exist that do something similar but for the wrong form of sql! Every flavour does variables differently:</p>
<ul>
<li><a href="https://github.com/blakeembrey/sql-template-tag"><code>sql-template-tag</code></a>: The origin for this part of the module. - supports postgres and mysql</li>
<li><a href="https://github.com/felixfbecker/node-sql-template-strings"><code>node-sql-template-strings</code></a>: promotes mutation via chained methods and lacks nesting SQL statements. - supports postgres and mysql</li>
<li><a href="https://github.com/XeCycle/pg-template-tag"><code>pg-template-tag</code></a>: missing TypeScript and MySQL support. By supporting <code>pg</code> only it has the ability to <a href="https://github.com/XeCycle/pg-template-tag/issues/5#issuecomment-386875336">dedupe <code>values</code></a>. - That&#39;s where I got the idea to dedupe values in this fork.</li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/Sql.html" class="tsd-kind-icon">Sql</a></li><li class="tsd-kind-interface"><a href="interfaces/Configuration.html" class="tsd-kind-icon">Configuration</a></li><li class="tsd-kind-type-alias"><a href="modules.html#BindWithName" class="tsd-kind-icon">Bind<wbr/>With<wbr/>Name</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ConfigOrConnection" class="tsd-kind-icon">Config<wbr/>Or<wbr/>Connection</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Logger" class="tsd-kind-icon">Logger</a></li><li class="tsd-kind-type-alias"><a href="modules.html#RawValue" class="tsd-kind-icon">Raw<wbr/>Value</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Value" class="tsd-kind-icon">Value</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ValueArray" class="tsd-kind-icon">Value<wbr/>Array</a></li><li class="tsd-kind-variable"><a href="modules.html#configuration" class="tsd-kind-icon">configuration</a></li><li class="tsd-kind-variable"><a href="modules.html#empty" class="tsd-kind-icon">empty</a></li><li class="tsd-kind-variable"><a href="modules.html#poolOptions" class="tsd-kind-icon">pool<wbr/>Options</a></li><li class="tsd-kind-function"><a href="modules.html#createPool" class="tsd-kind-icon">create<wbr/>Pool</a></li><li class="tsd-kind-function"><a href="modules.html#getPoolConnection" class="tsd-kind-icon">get<wbr/>Pool<wbr/>Connection</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#getSql" class="tsd-kind-icon">get<wbr/>Sql</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#getSqlPool" class="tsd-kind-icon">get<wbr/>Sql<wbr/>Pool</a></li><li class="tsd-kind-function"><a href="modules.html#join" class="tsd-kind-icon">join</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#mutateManySql" class="tsd-kind-icon">mutate<wbr/>Many<wbr/>Sql</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#mutateManySqlPool" class="tsd-kind-icon">mutate<wbr/>Many<wbr/>Sql<wbr/>Pool</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#mutateSql" class="tsd-kind-icon">mutate<wbr/>Sql</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#mutateSqlPool" class="tsd-kind-icon">mutate<wbr/>Sql<wbr/>Pool</a></li><li class="tsd-kind-function"><a href="modules.html#raw" class="tsd-kind-icon">raw</a></li><li class="tsd-kind-function"><a href="modules.html#setSqlErrorLogger" class="tsd-kind-icon">set<wbr/>Sql<wbr/>Error<wbr/>Logger</a></li><li class="tsd-kind-function"><a href="modules.html#sql" class="tsd-kind-icon">sql</a></li><li class="tsd-kind-function"><a href="modules.html#toBindDefs" class="tsd-kind-icon">to<wbr/>Bind<wbr/>Defs</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>